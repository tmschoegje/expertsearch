# Parse logs and analyze results
p5_logs = 'time 1639057109040 task -1 window open?\ntime 1639057109575 task -1 query utrecht numresults 1030\ntime 1639057139223 starting task 0\ntime 1639057158319 task 0 window open?\ntime 1639057158498 task 0 query speculatiebeding numresults 1\ntime 1639057161620 task 0 toggle on R. van Essen numresults 1\ntime 1639057169814 task 0 window open?\ntime 1639057169992 task 0 query speculatie numresults 1\ntime 1639057175554 task 0 window open?\ntime 1639057175645 task 0 query speculatiebeding numresults 1\ntime 1639057178256 task 0 window open?\ntime 1639057178339 task 0 query speculatie numresults 1\ntime 1639057184492 task 0 toggle on M.E.J. van Lijden numresults 1\ntime 1639057187764 task 0 window open?\ntime 1639057187929 task 0 query beding numresults 2\ntime 1639057227248 stopping task 0\ntime 1639057230287 starting task 1\ntime 1639057244443 task 1 window open?\ntime 1639057244645 task 1 query wijkaanpak overvecht numresults 287\ntime 1639057252606 task 1 toggle on W.M. Hendrix numresults 1\ntime 1639057254681 task 1 toggle on M. van den Berg numresults 1\ntime 1639057283654 task 1 toggle on M.P.D.J. van der Horst numresults 1\ntime 1639057289249 task 1 window close?\ntime 1639057297522 stopping task 1\ntime 1639057303173 starting task 2\ntime 1639057311385 task 2 window open?\ntime 1639057311775 task 2 query rosendael numresults 4\ntime 1639057357942 task 2 toggle on R.J. Evelein numresults 1\ntime 1639057420932 task 2 toggle on S.B. Beenen numresults 1\ntime 1639057425477 stopping task 2\ntime 1639057431109 starting task 3\ntime 1639057434472 task 3 window close?\ntime 1639057437315 task 3 window open?\ntime 1639057437643 task 3 query rosendael numresults 4\ntime 1639057458838 task 3 window open?\ntime 1639057459410 task 3 query uithoflijn numresults 41\ntime 1639057469208 task 3 toggle on J.H. Greeven numresults 1\ntime 1639057569097 task 3 toggle on S.C. de Gier numresults 1\ntime 1639057577510 stopping task 3\ntime 1639057579565 task -1 window open?\ntime 1639057579983 task -1 query uithoflijn numresults 41\ntime 1639057581580 starting task 4\ntime 1639057586059 task 4 window open?\ntime 1639057586308 task 4 query fietsgedrag numresults 2\ntime 1639057607619 task 4 toggle on Martijn Dijkhof numresults 1\ntime 1639057616068 task 4 window open?\ntime 1639057616626 task 4 query allochtonen numresults 6\ntime 1639057624297 task 4 window open?\ntime 1639057624560 task 4 query allochtonen fiets numresults 170\ntime 1639057626844 task 4 window open?\ntime 1639057627168 task 4 query allochtonen  numresults 6\ntime 1639057629791 task 4 window open?\ntime 1639057630014 task 4 query allochtonen fiets numresults 170\ntime 1639057660028 task 4 window open?\ntime 1639057660373 task 4 query allochtonen AND fiets numresults 1\ntime 1639057669912 task 4 window open?\ntime 1639057670249 task 4 query allochtonen  numresults 6\ntime 1639057678293 stopping task 4\ntime 1639057679886 starting task 5\ntime 1639057685844 task 5 window open?\ntime 1639057686074 task 5 query toerisme numresults 34\ntime 1639057771157 task 5 toggle on V.J. Drost numresults 3\ntime 1639057801852 stopping task 5\ntime 1639057803141 starting task 6\ntime 1639057819896 task 6 window open?\ntime 1639057820307 task 6 query arbeidsplaatsen numresults 20\ntime 1639057824476 task 6 toggle on Aloys Kersten numresults 2\ntime 1639057835978 task 6 window open?\ntime 1639057836343 task 6 query bedrijven numresults 299\ntime 1639057847167 task 6 window open?\ntime 1639057847663 task 6 query bedrijven vestigen numresults 327\ntime 1639057860328 stopping task 6\ntime 1639057861925 starting task 7\ntime 1639057867664 task 7 window open?\ntime 1639057867988 task 7 query overvecht kinderen numresults 391\ntime 1639057885762 task 7 window open?\ntime 1639057886384 task 7 query overvecht kinderen huishouden numresults 401\ntime 1639057929210 task 7 window open?\ntime 1639057929770 task 7 query overvecht huishoudens numresults 319\ntime 1639057962401 task 7 window open?\ntime 1639057962737 task 7 query overvecht  numresults 284\ntime 1639057966461 task 7 window open?\ntime 1639057967145 task 7 query overvecht speelplek numresults 289\ntime 1639057970387 task 7 toggle on L.F. Eerden numresults 1\ntime 1639057972403 stopping task 7\n'
p5_logs = 'time 1639166937598 task -1 window open?\ntime 1639166937874 task -1 query utrecht numresults 1030\ntime 1639167056411 task -1 toggle on Ank Hendriks rank 0 numresults 3\ntime 1639167226502 starting task 0\ntime 1639167256339 task 0 window open?\ntime 1639167257397 task 0 query fiets allochtonen numresults 170\ntime 1639167267346 task 0 window open?\ntime 1639167267519 task 0 query "fiets allochtonen"  numresults 0 results\n\n\ntime 1639167276787 task 0 window open?\ntime 1639167277056 task 0 query "fietsgebruik allochtonen"  numresults 0 results\n\n\ntime 1639167282647 task 0 window open?\ntime 1639167283455 task 0 query fietsgebruik numresults 20\ntime 1639167302421 task 0 click 5821a285-971a-497d-8df9-c553b4e2274a\ntime 1639167320185 task 0 window open?\ntime 1639167320568 task 0 query fietsgebruik allochtonen numresults 26\ntime 1639167325653 task 0 click 083b59a7-bd5a-4898-ac55-b3d0b5c1f0a0\ntime 1639167385806 task 0 window open?\ntime 1639167386364 task 0 query fiets niet-westerse allochtonen numresults 929\ntime 1639167406485 task 0 window open?\ntime 1639167407210 task 0 query fiets "niet-westerse" allochtonen numresults 177\ntime 1639167435282 stopping task 0\ntime 1639167496085 starting task 1\ntime 1639167519294 task 1 window open?\ntime 1639167520544 task 1 query bouwplannen zorgcentrum rosendael corona numresults 147\ntime 1639167526571 task 1 click 64f5a0de-9679-4a0d-a7ca-1c35044c7d64\ntime 1639167563700 task 1 window open?\ntime 1639167564597 task 1 query zorgcentrum rosendael corona numresults 120\ntime 1639167584376 task 1 click 64f5a0de-9679-4a0d-a7ca-1c35044c7d64\ntime 1639167593649 task 1 window open?\ntime 1639167594397 task 1 query zorgcentrum rosendael voortgang numresults 427\ntime 1639167599435 task 1 window open?\ntime 1639167600236 task 1 query zorgcentrum rosendael  numresults 11\ntime 1639167617092 task 1 window open?\ntime 1639167617987 task 1 query verpleeghuis rosendael  numresults 9\ntime 1639167621518 task 1 click afec48fd-6a47-49b1-9f23-9d859821358c\ntime 1639167681625 task 1 toggle on P. Buisman rank 0 numresults 1\ntime 1639167687453 stopping task 1\ntime 1639167759695 starting task 2\ntime 1639167788266 task 2 window open?\ntime 1639167789072 task 2 query toerisme utrecht numresults 1030\ntime 1639167814994 task 2 window open?\ntime 1639167815316 task 2 query toerisme  numresults 34\ntime 1639167836503 task 2 query toerisme  numresults 47\ntime 1639167848689 task 2 query toerisme  numresults 47\ntime 1639167856421 task 2 toggle on V.J. Drost rank 0 numresults 3\ntime 1639167869662 task 2 toggle on D.S.M. van de Ven rank 3 numresults 3\ntime 1639167873296 stopping task 2\ntime 1639167933906 starting task 3\ntime 1639167955077 task 3 window open?\ntime 1639167955485 task 3 query bedrijven vestige numresults 299\ntime 1639167957602 task 3 window open?\ntime 1639167958512 task 3 query bedrijven vestigen numresults 327\ntime 1639167993324 task 3 window open?\ntime 1639167993746 task 3 query bedrijven wijken numresults 616\ntime 1639167997695 task 3 window close?\ntime 1639167997927 task 3 window open?\ntime 1639167998596 task 3 query bedrijven vestigen numresults 327\ntime 1639168001048 task 3 window open?\ntime 1639168001325 task 3 query bedrijven  numresults 299\ntime 1639168023734 task 3 window open?\ntime 1639168024330 task 3 query bedrijven overzicht numresults 498\ntime 1639168039280 task 3 window open?\ntime 1639168039852 task 3 query bedrijven vestigen numresults 327\ntime 1639168043625 task 3 toggle on Aloys Kersten rank 0 numresults 1\ntime 1639168048842 stopping task 3\ntime 1639168051350 task -1 window open?\ntime 1639168051680 task -1 query bedrijven vestigen numresults 595\ntime 1639168328680 starting task 4\ntime 1639168336514 task 4 window open?\ntime 1639168336927 task 4 query anti-speculatiebeding numresults 35\ntime 1639168349551 task 4 window open?\ntime 1639168349776 task 4 query "anti-speculatiebeding" numresults 1\ntime 1639168356893 task 4 window open?\ntime 1639168357193 task 4 query speculatiebeding numresults 1\ntime 1639168364447 task 4 click e8535fda-db98-4df8-bf93-0b9c76b5ddb0\ntime 1639168394785 task 4 window open?\ntime 1639168395078 task 4 query speculatie numresults 1\ntime 1639168410127 task 4 toggle on M.E.J. van Lijden rank 0 numresults 1\ntime 1639168417900 task 4 window open?\ntime 1639168418197 task 4 query speculatiebeding numresults 1\ntime 1639168420722 task 4 toggle on R. van Essen rank 0 numresults 1\ntime 1639168423304 stopping task 4\ntime 1639168519906 starting task 5\ntime 1639168528524 task 5 window open?\ntime 1639168528983 task 5 query uithoflijn numresults 94\ntime 1639168535773 task 5 toggle on J.H. Greeven rank 0 numresults 1\ntime 1639168553654 task 5 toggle on B. Coenen rank 1 numresults 1\ntime 1639168563401 task 5 toggle on S.C. de Gier rank 4 numresults 1\ntime 1639168565751 stopping task 5\ntime 1639168634794 starting task 6\ntime 1639168650401 task 6 window open?\ntime 1639168650820 task 6 query overvecht bevolkingsgroei numresults 562\ntime 1639168655298 task 6 window open?\ntime 1639168655985 task 6 query overvecht  numresults 550\ntime 1639168670759 task 6 query overvecht  numresults 550\ntime 1639168686842 task 6 query overvecht  numresults 549\ntime 1639168713755 task 6 query overvecht  numresults 550\ntime 1639168716923 task 6 query overvecht  numresults 549\ntime 1639168717791 task 6 query overvecht  numresults 550\ntime 1639168718649 task 6 query overvecht  numresults 550\ntime 1639168730770 task 6 query overvecht  numresults 550\ntime 1639168741966 task 6 window open?\ntime 1639168742758 task 6 query overvecht huishoudens numresults 647\ntime 1639168756899 task 6 window open?\ntime 1639168757217 task 6 query "huishoudens in overvecht"  numresults 0 results\n\n\ntime 1639168761094 task 6 window open?\ntime 1639168761776 task 6 query huishoudens in overvecht numresults 4300\ntime 1639168826563 task 6 toggle on E.S. Quak rank 8 numresults 1\ntime 1639168828810 task 6 toggle off E.S. Quak rank 7 numresults 1\ntime 1639168832809 stopping task 6\ntime 1639168910257 starting task 7\ntime 1639168932724 task 7 window open?\ntime 1639168933470 task 7 query wijkaanpak overvecht numresults 558\ntime 1639168956528 task 7 toggle on W.M. Hendrix rank 0 numresults 1\ntime 1639168966101 task 7 toggle on M. van den Berg rank 1 numresults 1\ntime 1639168973527 stopping task 7\n'

logs = [p5_logs]

#Randomly generated task orders from python shuffle
n = 25
task_order = ['07314625', '15740236', '41605273', '01325746', '30265147', '45760312', '16025734', '30167254', '54326017', '64721503', '60513427', '06324715', '32146057', '21450736', '32461057', '61534720', '02164735', '63157402', '15327460', '42675031', '20174653', '61427053', '42173650', '23701564', '63714520']

interface_order = ['can', 'doc', 'can', 'doc','can', 'doc','can', 'doc','can', 'doc','can', 'doc','can', 'doc','can', 'doc','can', 'doc','can', 'doc','can', 'doc','can', 'doc','can']

ranking1_order = ['can', 'can', 'doc', 'doc', 'can', 'can', 'doc', 'doc', 'can', 'can', 'doc', 'doc', 'can', 'can', 'doc', 'doc', 'can', 'can', 'doc', 'doc', 'can', 'can', 'doc', 'doc', 'can']
ranking2_order = ['doc', 'doc', 'can', 'can', 'can', 'can', 'doc', 'doc', 'doc', 'doc', 'can', 'can', 'can', 'can', 'doc', 'doc', 'doc', 'doc', 'can', 'can', 'can', 'can', 'doc', 'doc', 'doc']






#metrics to keep track off for now
#time per task 
#number ticked per task
#number ticked correct per task
#document clicks per task



participants = []

for log in logs:
    #stuff we keep track of per participant
    p = []
    for i in range(8):
        p.append({  'clicks': 0, 
                    'toggles': "",
                    'numtoggles': 0,
                    'numrelevant': 0,
                    'queries': 0,
                    'starttime':0,
                    'endtime':0,
                    'delays':0,         # if the windows was accidentally closed, add missed time to delays 
                    'time':0})
    
    prevline = ''
    curtask = -1
    for line in log.split("\n"):
        lp = line.split(" ")
        print(line)

        #if the window was closed and re opened during an active task, add the difference to the 'delay'
        if 'window open' in line and 'window close' in prevline and curtask > -1:
            p[curtask]['delays'] += int(lp[1]) - int(prevline.split(" ")[1])
            
        if 'query' in line and curtask > -1:
            p[curtask]['queries'] += 1
        
        if 'starting task' in line:
            curtask = int(lp[-1])
            p[curtask]['starttime'] = int(lp[1])
            
        if 'toggle' in line and curtask > -1:
            if lp[-5] in p[curtask]['toggles']:
                p[curtask]['numtoggles'] -= 1
                p[curtask]['toggles'] = p[curtask]['toggles'].replace((" ").join(lp[6:-4]), "")
                p[curtask]['numrelevant'] -= int(lp[-1])
            else:
                p[curtask]['numtoggles'] += 1
                p[curtask]['toggles'] += (" ").join(lp[6:-4])
                p[curtask]['numrelevant'] += int(lp[-1])
                
        if 'click' in line and curtask > -1:
            p[curtask]['clicks'] += 1
            
        if 'stopping task' in line and curtask > -1:
            p[curtask]['endtime'] = int(lp[1])
            p[curtask]['time'] = p[curtask]['endtime'] - p[curtask]['starttime'] - p[curtask]['delays']
            curtask = -1
        
        prevline = line

for task in p:
    print(task)
    
    #toggle off toggle on
    # TODO test toggle off